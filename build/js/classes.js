"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var $mctrl=new function(){var a=this;return a.__objects={},a.randstr=function(t){return Math.random().toString(t||36).split(".")[1]},a.merge=function(){for(var t=_typeof(new Object),e={},n=0;n<arguments.length;n++){var s=arguments[n];if(_typeof(s)==t)for(var o in s)try{_typeof(s[o])==t?e[o]=a.merge(e[o],s[o]):e[o]=s[o]}catch(t){e[o]=s[o]}}return e},a.set=function(t,e){a.__objects[t]=e},a.get=function(t){return a.__objects[t]?a.__objects[t]:null},a};!function(t){var e,n,s,o,l;t.set("isDev",!0),e=t,(n=new function(){this.__data=null}).__classes={},n.__classes_params={},n.getClassName=function(){return"Classes"},n.setClass=function(t,e){this.__classes[t]=e},n.getClass=function(t){return void 0!==this.__classes[t]?this.__classes[t]:null},e.set("Classes",n),t.set("Debug",new function(){var t=this;return t.getClassName=function(){return"Debug"},t.ed=function(t,e){return e?JSON.stringify(t):JSON.stringify(t,null,"\t")},t.getStack=function(){var e;try{throw Exception()}catch(t){e=t.stack.split(/\n/g)}return e.map(function(t){return t.trim()})},t.getTrace=function(){var e;try{throw Exception()}catch(t){e=t.stack.split(/\n/g)}return e.shift(),e.map(function(t){var e,n=t.replace(/^\s*at\s+/,"");return(e=n.match(/([^\s\(]+) \(([^:]+):(\d+):(\d+)\)/))?{funcName:e[1],filePath:e[2],strNum:e[3],colNum:e[4]}:(e=n.match(/([^:]+):(\d+):(\d+)/))?{filePath:e[1],strNum:e[2],colNum:e[3]}:null})},t.getFuncName=function(t){var e=null;if(t&&t[1]&&(e=t[1].funcName?t[1].funcName:null)){var n=e.split(".");n[1]&&(e=n[1])}return e},t}),function(t){function e(){}e.prototype.getClassName=function(){return"Abstract"},t.get("Classes").setClass(e.prototype.getClassName(),e)}(t),function(t){function e(t){var e=t+"Storage",s=null;if(t&&""!=t&&e in window){var o=window[e];s={__prefix:"crm.",__modUid:function(t){return s.__prefix+t},set:function(t,e){o.setItem(s.__modUid(t),JSON.stringify(e))},get:function(t,e){var n=o.getItem(s.__modUid(t));return void 0!==n&&null!=n?JSON.parse(n):e},remove:function(t){o.removeItem(s.__modUid(t))},clear:function(){o.clear()}}}else s={get:function(t,e){e=e||null;var n=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return n?decodeURIComponent(n[1]):e},set:function(t,e,n){(n=n||{}).path||(n.path="/");var s=n.expires;if(s&&"number"==typeof s){var o=new Date;o.setTime(o.getTime()+1e3*s),s=n.expires=o}s&&s.toUTCString&&(n.expires=s.toUTCString());var a=t+"="+(e=encodeURIComponent(e));for(var i in n){a+="; "+i;var r=n[i];!0!==r&&(a+="="+r)}document.cookie=a},remove:function(t){s.set(t,"",{expires:(-1).toUTCString()})},clear:function(){for(var t=document.cookie.split(";"),e=0;e<t.length;e++){var n=t[e],s=n.indexOf("="),o=-1<s?n.substr(0,s):n;document.cookie=o+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}};return s}e.prototype.getClassName=function(){return"Storage"},t.get("Classes").setClass(e.prototype.getClassName(),e)}(t),(s=t).set("Events",new function(){return this.getClassName=function(){return"Events"},this.log=function(t,e){console.log((new Date).getTime(),t)},this.error=function(t,e){s.get("vueApp")?s.get("vueApp").$store.commit("saveError",{error:t,data:e}):console.error({error:t,data:e})},this}),t.set("VComp",new function(){var c=this;return c.__components={},c.__in_request={},c.__in_request_cb={},c.api_params={},c.updateApiParams=function(t){c.api_params=t},c.updateApiParams(JSON.parse(document.body.getAttribute("data-api-params")||"{}")),c.apiInstance=axios.create({baseURL:c.api_params.url.vcomp,method:"get",headers:{"X-API-Key":c.api_params.keys.api,"X-Organization-Key":c.api_params.keys.organization,"X-Profile-Key":c.api_params.keys.profile},timeout:1e4,withCredentials:!0,responseEncoding:"utf8",validateStatus:function(t){return 200<=t&&t<300}}),c.buildPath=function(t,e){var n=[t];return Object.keys(e).length&&(n=n.concat(Object.keys(e))),n},c.setComponent=function(t,n){if(n&&t){var s=t;"string"==typeof s&&(s=s.split("/"));var o=c.__components;return s.forEach(function(t,e){o[t]||(o[t]={}),e<s.length-1||(o[t]=n),o=o[t]}),o}},c.getComponent=function(t,e){var n=t;"string"==typeof n&&(n=n.split("/"));var s=c.__components;return n.forEach(function(t,e){s[t]&&(s=s[t])}),s},c.isComponent=function(t){if(!t)return!1;var n=!1,s=t;"string"==typeof s&&(s=s.split("/"));var o=c.__components;return s.forEach(function(t,e){(o=o&&o[t]?o[t]:null)&&e==s.length-1&&_typeof(o)==_typeof(new Object)&&(n=!0)}),n},c.loadComponentByUrl=function(t,e,n){var _=document.body;c.apiInstance.request({url:t+".vcomp.html",params:e}).then(function(t){var e=document.createElement("div");e.innerHTML=t.data;var u=[];Array.prototype.map.call(e.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase(),n=document.createElement(e),s=!0,o=!1,a=void 0;try{for(var i,r=t.getAttributeNames()[Symbol.iterator]();!(s=(i=r.next()).done);s=!0){var l=i.value,c=t.getAttribute(l);n.setAttribute(l,c)}}catch(t){o=!0,a=t}finally{try{s||null==r.return||r.return()}finally{if(o)throw a}}n.innerHTML=t.innerHTML.trim(),_.appendChild(n),u.push(n)}return null}),n&&n(u)}).catch(function(t){$mctrl.get("Events").error(t,{module:"vcomp",url:window.location.href})}).finally(function(){})},c.require_global=function(t,e,n,s){var o=n&&n.context?n.context:null;if(o){var a=t.tagName.toLowerCase(),i=c.buildPath(e.arg,e.modifiers),r=i.join("/");if(Vue.options.components[a]||c.__in_request[r])c.__in_request_cb[r]||(c.__in_request_cb[r]=[]),c.__in_request_cb[r].push(function(){Vue.options.components[a]||Vue.component(a,c.getComponent(i,{})),o.$forceUpdate()});else if(c.isComponent(i))Vue.component(a,c.getComponent(i,{})),o.$forceUpdate();else{c.__in_request[r]=!0,c.__in_request_cb[r]=[];var l={tag:a,path:r,value:e.value,rawName:e.rawName};c.loadComponentByUrl(r,l,function(t){Vue.component(a,c.getComponent(i,{})),c.__in_request_cb[r].forEach(function(t){t()}),c.__in_request_cb[r]=[],c.__in_request[r]=!1,o.$forceUpdate()})}}},c.require_local=function(t,e,n,s){var o=n&&n.context?n.context:null;if(o){var a=t.tagName.toLowerCase(),i=c.buildPath(e.arg,e.modifiers),r=i.join("/");if(o.$options.components[a]||c.__in_request[r])c.__in_request_cb[r]||(c.__in_request_cb[r]=[]),c.__in_request_cb[r].push(function(){o.$options.components[a]||(o.$options.components[a]=c.getComponent(i,{})),o.$forceUpdate()});else if(c.isComponent(i))o.$options.components[a]=c.getComponent(i,{}),o.$forceUpdate();else{c.__in_request[r]=!0,c.__in_request_cb[r]=[];var l={tag:a,path:r,value:e.value,rawName:e.rawName};c.loadComponentByUrl(r,l,function(t){o.$options.components[a]=c.getComponent(i,{}),c.__in_request_cb[r].forEach(function(t){t()}),c.__in_request_cb[r]=[],c.__in_request[r]=!1,o.$forceUpdate()})}}},c.dev_test=function(t,e,n,s){var o=[e.arg];Object.keys(e.modifiers).length&&(o=o.concat(Object.keys(e.modifiers))),t.innerHTML=o.join("/")},c}),(o=t).set("Api",new function(){var l=this;return l.api_params={},l.getClassName=function(){return"Api"},l.updateApiParams=function(t){l.api_params=t},l.getApiParams=function(){return l.api_params},l.updateApiParams(JSON.parse(document.body.getAttribute("data-api-params")||"{}")),l.apiInstance=axios.create({baseURL:l.api_params.url.api,method:l.api_params.method,headers:{"X-API-Key":l.api_params.keys.api,"X-Organization-Key":l.api_params.keys.organization,"X-Profile-Key":l.api_params.keys.profile},timeout:1e4,withCredentials:!0,responseType:"json",responseEncoding:"utf8",validateStatus:function(t){return 200<=t&&t<300}}),l.responseCb=function(s){return function(t){if(s)if(t&&t.data){var e=t.data.data||{},n=t.data.meta||{};s(null,e,n)}else s(error)}},l.catchCb=function(e){return function(t){o.get("Events").error(t,{module:l.getClassName(),url:window.location.href}),e&&e(t)}},l.finallyCb=function(t){return function(t){}},l.call=function(t,e,n,s){var o={url:t,data:{meta:n||{},data:e}};l.apiInstance.request(o).then(l.responseCb(s)).catch(l.catchCb(s)).finally(l.finallyCb(s))},l.upload=function(t,e,n,s,o){for(var a=new FormData,i=0;i<e.length;i++)a.append(n.namespace+"[]",e[i]);var r={onUploadProgress:function(t){var e=Math.round(100*t.loaded/t.total);o&&o(e)},headers:{"Content-Type":"multipart/form-data"}};l.apiInstance.post(l.api_params.url.api+t,a,r).then(l.responseCb(s)).catch(l.catchCb(s)).finally(l.finallyCb(s))},l}),(l=t).set("aCRM",new function(){var r=this;return r.__classes=null,r.__entities={},r.__intervals={loadSession:null},r.getClassName=function(){return"aCRM"},r.getDefaultEntityClass=function(){return"Common\\Entity"},r.loadEntityClasses=function(a){var i=l.get("SS");if(r.__classes&&Object.keys(r.__classes).length)a&&a(r.__classes);else{var t=i.get("classes");t&&Object.keys(t).length?(r.__classes=t,a&&a(r.__classes)):l.get("Api").call("Entity/Classes",null,null,function(t,e,n){for(var s in t&&l.get("Events").error(t,{module:r.getClassName(),url:window.location.href}),r.__classes={},e){var o=e[s].entity_class;r.__classes[o]=e[s],r.__entities[o]={}}i.set("classes",r.__classes),a&&a(r.__classes)})}},r.loadSession=function(s){l.get("Api").call("Session/Get",null,null,function(t,e,n){t&&l.get("Events").error(t,{module:r.getClassName(),url:window.location.href}),l.get("vueApp").$store.dispatch("setSession",e),e&&e.profile&&e.profile.item&&e.profile.item.photo_id&&r.getFileInfo(e.profile.item.photo_id,function(t,e,n){l.get("vueApp").$store.dispatch("setSessionPhoto",e)}),s&&s(t,e,n)})},r.sessionUpdater=function(t){t=t||4e3,r.clearSessionUpdater(),r.__intervals.loadSession=setInterval(r.loadSession,t)},r.clearSessionUpdater=function(){r.__intervals.loadSession&&clearInterval(r.__intervals.loadSession)},r.initEntity=function(t,e,n){var s=null;return s=(t=l.get("Classes").getClass(t))?new t(e):new(t=l.get("Classes").getClass(r.getDefaultEntityClass()))(e),n&&n(s),s},r.buildEntity=function(t){var e=l.get("Classes").getClass(t);return e||(e=l.get("Classes").getClass(r.getDefaultEntityClass())),new e},r.loadEntity=function(o,t,a){r.__classes[o]?t&&t.id&&r.__entities[o]&&r.__entities[o][t.id]?a(r.__entities[o][t.id]):l.get("Api").call("Entity/Item",{entity_class:{id:r.__classes[o].id},item:t},null,function(t,e,n){if(t&&l.get("Events").error(t,{module:r.getClassName(),url:window.location.href}),e&&e.item&&e.item.id){var s=l.get("Classes").getClass(o);r.__entities[o]||(r.__entities[o]={}),s?r.__entities[o][e.item.id]=new s(e):(s=l.get("Classes").getClass(r.getDefaultEntityClass()),r.__entities[o][e.item.id]=new s(e),r.__entities[o][e.item.id].mergeEntityClass(r.__classes[o])),a(r.__entities[o][e.item.id])}else console.log("wrong response",arguments)}):console.error("Not founded class",o)},r.loadEntities=function(t,e,s){if(r.__classes[t]){var n={entity_class:{id:r.__classes[t].id}};e.pagination&&(n.pagination=e.pagination),e.order_by&&(n.order_by=e.order_by),e.where&&(n.where=e.where),l.get("Api").call("Entity/Items",n,null,function(t,e,n){t&&l.get("Events").error(t,{module:r.getClassName(),url:window.location.href}),s&&s(t,e,n)})}else console.error("Not founded class",t)},r.logEvent=function(t,e){l.get("Api").call("Log/Event",t,null,function(t,e,n){t&&l.get("Events").error(t,{module:r.getClassName(),url:window.location.href}),console.debug(e)})},r.getFileInfo=function(t,s){t&&l.get("Api").call("Common/File/Get",{entity_class:{entity_class:"Common\\Entity\\File"},item:{id:t}},null,function(t,e,n){t?l.get("Events").error(t,{module:r.getClassName(),url:window.location.href}):s&&s(t,e,n)})},r}),function(t){function e(t){this.__data={item:{},data:{}},this.setChanges(t),this.__entity_class=e.prototype.__entity_class}((e.prototype=Object.create(t.get("Classes").getClass("Abstract").prototype)).constructor=e).prototype.__entity_class={id:0,entity_class:t.get("aCRM").getDefaultEntityClass()},e.prototype.getClass=function(t){return this.__entity_class&&t in this.__entity_class?this.__entity_class[t]:this.__entity_class},e.prototype.getClassName=function(){return this.getClass("entity_class")},e.prototype.mergeEntityClass=function(t){this.__entity_class=t},e.prototype.setChanges=function(t){if(t)for(var e in t)for(var n in t[e])void 0===this.__data[e]&&(this.__data[e]={}),void 0===this.__data[e][n]&&(this.__data[e][n]={}),this.__data[e][n]=t[e][n]},e.prototype.saveChanges=function(t,e){this.setChanges(t),this.save(e)},e.prototype.item=function(t,e){return t?(_typeof(t)==_typeof(new Object)?this.setChanges({item:t}):void 0!==e&&(this.__data.item[t]=e),this.__data.item[t]):this.__data.item},e.prototype.data=function(t,e){return t?(_typeof(t)==_typeof(new Object)?this.setChanges({data:t}):void 0!==e&&(this.__data.data[t]=e),this.__data.data[t]):this.__data.data},e.prototype.load=function(t,s){var o=this;$mctrl.get("Api").call("Entity/Item",{entity_class:{id:this.getClass("id")},item:t},null,function(t,e,n){t&&$mctrl.get("Events").error(t,{module:o.getClassName(),url:window.location.href}),e&&e.item&&e.item.id?(o.setChanges(e),s&&s(o)):console.log("wrong response",arguments)})},e.prototype.save=function(s){var o=this,t={entity_class:{id:o.__entity_class.id,entity_class:o.__entity_class.entity_class},item:o.item(),data:o.data()},e="Entity/Create";o.item("id")&&(e="Entity/Update"),$mctrl.get("Api").call(e,t,null,function(t,e,n){t&&$mctrl.get("Events").error(t,{module:this.getClass("entity_class"),url:window.location.href}),o.__data=e,s&&s(o)})},e.prototype.update=function(t,s){var o=this,e={entity_class:{id:o.__entity_class.id,entity_class:o.__entity_class.entity_class},item:{},data:{}};if(t)for(var n in t)for(var a in e[n]||(e[n]={}),t[n])e[n][a]=t[n][a];o.item("id")&&(e.item.id=o.item("id"),$mctrl.get("Api").call("Entity/Update",e,null,function(t,e,n){t&&$mctrl.get("Events").error(t,{module:this.getClass("entity_class"),url:window.location.href}),o.__data=e,s&&s(o)}))},e.prototype.remove=function(t){},e.prototype.state=function(t){},e.prototype.instate=function(t){},e.prototype.bound=function(t){},e.prototype.unbound=function(t){},e.prototype.bounded=function(t){},e.prototype.tied=function(t){},e.prototype.getOpenedStates=function(t){},e.prototype.getBoundsWith=function(t){},e.prototype.getStateHistory=function(t){},e.prototype.toPublicJSON=function(){return this.__data},t.get("Classes").setClass(e.prototype.getClass("entity_class"),e)}(t),function(t){function e(t){}((e.prototype=Object.create(t.get("Classes").getClass("Abstract").prototype)).constructor=e).prototype.__entity_class={id:0,entity_class:"Common\\Collection"},e.prototype.getClass=function(t){return this.__entity_class&&t in this.__entity_class?this.__entity_class[t]:this.__entity_class},t.get("Classes").setClass(e.prototype.getClass("entity_class"),e)}(t),function(t){function e(t){this.__data={item:{},data:{}},this.setChanges(t)}((e.prototype=Object.create(t.get("Classes").getClass(t.get("aCRM").getDefaultEntityClass()).prototype)).constructor=e).prototype.__entity_class={id:1,entity_class:"Common\\Entity\\Other"},t.get("Classes").setClass(e.prototype.getClass("entity_class"),e)}(t),function(t){function e(t){this.__data={item:{},data:{},chessy:{}},this.setChanges(t)}((e.prototype=Object.create(t.get("Classes").getClass(t.get("aCRM").getDefaultEntityClass()).prototype)).constructor=e).prototype.__entity_class={id:14,entity_class:"Common\\Entity\\Realty\\Building"},e.prototype.getChessy=function(){return this.__data.chessy},t.get("Classes").setClass(e.prototype.getClass("entity_class"),e)}(t),t.set("LS",new(t.get("Classes").getClass("Storage"))("local")),t.set("SS",new(t.get("Classes").getClass("Storage"))("session")),t.set("Cookie",new(t.get("Classes").getClass("Storage"))("cookie"))}($mctrl);